562dc294aa0459c7fc1f73071acd3b6a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getFxRatesLatest = exports.getFxRates = exports.saveExchangeRates = void 0;
const constants_1 = require("../constants");
const datetime_1 = require("../utils/datetime");
const saveExchangeRates = async (app, exchangeRates) => {
    await app.knex
        .table(constants_1.DB_EXCHANGE_RATE_TABLE)
        .insert(exchangeRates)
        .onConflict('posting_date')
        .ignore();
};
exports.saveExchangeRates = saveExchangeRates;
const getFxRates = async (app, latest) => {
    if (latest) {
        return await app.knex.table(constants_1.DB_EXCHANGE_RATE_TABLE).select().where({ posting_date: (0, datetime_1.getDateWithoutTime)().toISOString() }).first();
    }
    return await app.knex.table(constants_1.DB_EXCHANGE_RATE_TABLE).select();
};
exports.getFxRates = getFxRates;
const getFxRatesLatest = async (app) => {
    return await app.knex.table(constants_1.DB_EXCHANGE_RATE_TABLE).select().where({ posting_date: (0, datetime_1.getDateWithoutTime)().toISOString() }).first();
};
exports.getFxRatesLatest = getFxRatesLatest;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpbW5hY2lzY2lvbmlzL2dpdC9wZXJzb25hbC9zZWItZXhjaGFuZ2UtcmF0ZXMvc3JjL3JlcG9zaXRvcmllcy9leGNoYW5nZS1yYXRlLXJlcG9zaXRvcnkudHMiLCJtYXBwaW5ncyI6Ijs7O0FBRUEsNENBQXNEO0FBQ3RELGdEQUF1RDtBQUVoRCxNQUFNLGlCQUFpQixHQUFHLEtBQUssRUFBRSxHQUFvQixFQUFFLGFBQXdCLEVBQUUsRUFBRTtJQUN4RixNQUFNLEdBQUcsQ0FBQyxJQUFJO1NBQ1gsS0FBSyxDQUFDLGtDQUFzQixDQUFDO1NBQzdCLE1BQU0sQ0FBQyxhQUFhLENBQUM7U0FDckIsVUFBVSxDQUFDLGNBQWMsQ0FBQztTQUMxQixNQUFNLEVBQUUsQ0FBQztBQUNkLENBQUMsQ0FBQztBQU5XLFFBQUEsaUJBQWlCLHFCQU01QjtBQUVLLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFBRSxHQUFvQixFQUFFLE1BQWdCLEVBQXdCLEVBQUU7SUFDL0YsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNYLE9BQU8sTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQ0FBc0IsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVksRUFBRSxJQUFBLDZCQUFrQixHQUFFLENBQUMsV0FBVyxFQUFFLEVBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2xJLENBQUM7SUFFRCxPQUFPLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsa0NBQXNCLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUMvRCxDQUFDLENBQUM7QUFOVyxRQUFBLFVBQVUsY0FNckI7QUFFSyxNQUFNLGdCQUFnQixHQUFHLEtBQUssRUFBRSxHQUFvQixFQUFzQixFQUFFO0lBQ2pGLE9BQU8sTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQ0FBc0IsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVksRUFBRSxJQUFBLDZCQUFrQixHQUFFLENBQUMsV0FBVyxFQUFFLEVBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQ2xJLENBQUMsQ0FBQztBQUZXLFFBQUEsZ0JBQWdCLG9CQUUzQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2ltbmFjaXNjaW9uaXMvZ2l0L3BlcnNvbmFsL3NlYi1leGNoYW5nZS1yYXRlcy9zcmMvcmVwb3NpdG9yaWVzL2V4Y2hhbmdlLXJhdGUtcmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGYXN0aWZ5SW5zdGFuY2UgfSBmcm9tIFwiZmFzdGlmeVwiO1xuaW1wb3J0IHsgRnhSYXRlc0RiLCBGeFJhdGVzSnNvbiB9IGZyb20gXCIuLi9lbnRpdGllc1wiO1xuaW1wb3J0IHsgREJfRVhDSEFOR0VfUkFURV9UQUJMRSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IGdldERhdGVXaXRob3V0VGltZSB9IGZyb20gXCIuLi91dGlscy9kYXRldGltZVwiO1xuXG5leHBvcnQgY29uc3Qgc2F2ZUV4Y2hhbmdlUmF0ZXMgPSBhc3luYyAoYXBwOiBGYXN0aWZ5SW5zdGFuY2UsIGV4Y2hhbmdlUmF0ZXM6IEZ4UmF0ZXNEYikgPT4ge1xuICBhd2FpdCBhcHAua25leFxuICAgIC50YWJsZShEQl9FWENIQU5HRV9SQVRFX1RBQkxFKVxuICAgIC5pbnNlcnQoZXhjaGFuZ2VSYXRlcylcbiAgICAub25Db25mbGljdCgncG9zdGluZ19kYXRlJylcbiAgICAuaWdub3JlKCk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RnhSYXRlcyA9IGFzeW5jIChhcHA6IEZhc3RpZnlJbnN0YW5jZSwgbGF0ZXN0PzogYm9vbGVhbik6IFByb21pc2U8RnhSYXRlc0RiW10+ID0+IHtcbiAgaWYgKGxhdGVzdCkge1xuICAgIHJldHVybiBhd2FpdCBhcHAua25leC50YWJsZShEQl9FWENIQU5HRV9SQVRFX1RBQkxFKS5zZWxlY3QoKS53aGVyZSh7IHBvc3RpbmdfZGF0ZTogZ2V0RGF0ZVdpdGhvdXRUaW1lKCkudG9JU09TdHJpbmcoKX0pLmZpcnN0KCk7ICBcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBhcHAua25leC50YWJsZShEQl9FWENIQU5HRV9SQVRFX1RBQkxFKS5zZWxlY3QoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRGeFJhdGVzTGF0ZXN0ID0gYXN5bmMgKGFwcDogRmFzdGlmeUluc3RhbmNlKTogUHJvbWlzZTxGeFJhdGVzRGI+ID0+IHtcbiAgcmV0dXJuIGF3YWl0IGFwcC5rbmV4LnRhYmxlKERCX0VYQ0hBTkdFX1JBVEVfVEFCTEUpLnNlbGVjdCgpLndoZXJlKHsgcG9zdGluZ19kYXRlOiBnZXREYXRlV2l0aG91dFRpbWUoKS50b0lTT1N0cmluZygpfSkuZmlyc3QoKTtcbn07XG5cbiJdLCJ2ZXJzaW9uIjozfQ==