84b4e3dac95fe23c098bd15a64669e67
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock("../../../../src/plugins/knex-plugin", () => {
    return knexPlugin;
});
const helper_1 = require("../../../helper");
const fastify_plugin_1 = __importDefault(require("fastify-plugin"));
let app;
let knex = (0, helper_1.getDefaultKnexPluginParams)();
const knexPlugin = (0, fastify_plugin_1.default)(async (fastify, options) => {
    fastify.decorate("knex", knex);
});
beforeAll(async () => {
    app = await (0, helper_1.startTestEnv)();
});
beforeEach(async () => {
    jest.resetAllMocks();
});
afterAll(async () => {
    await (0, helper_1.stopTestEnv)();
});
describe('endpoints /public/exchange-rates calls', () => {
    describe("GET /public/exchange-rates/", () => {
        it("should response with exchange rates data", async () => {
            const data = [
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "117.201880",
                    exchange_date: "2023-01-22",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "116.201880",
                    exchange_date: "2023-01-21",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "115.201880",
                    exchange_date: "2023-01-20",
                },
                {
                    source_currency: "EUR",
                    target_currency: "JPY",
                    source_rate: "1",
                    target_rate: "120",
                    exchange_date: "2023-01-20",
                },
            ];
            knex.table = () => ({
                select: () => {
                    return [{ rates: JSON.stringify(data), posting_date: "2024-01-20" }];
                },
            });
            const exchangeRates = await app.inject({
                method: "GET",
                url: "/public/exchange-rates",
            });
            expect(exchangeRates.statusCode).toBe(200);
            expect(JSON.parse(exchangeRates.body)).toEqual({
                data: {
                    RSD: [
                        { date: '2023-01-22', source_rate: '1', target_rate: '117.201880' },
                        { date: '2023-01-21', source_rate: '1', target_rate: '116.201880' },
                        { date: '2023-01-20', source_rate: '1', target_rate: '115.201880' }
                    ],
                    JPY: [{ date: '2023-01-20', source_rate: '1', target_rate: '120' }]
                },
            });
        });
    });
    describe("GET /public/exchange-rates/:currency", () => {
        it("should return 404 not found", async () => {
            const exchangeRates = await app.inject({
                method: "GET",
                url: "/public/exchange-rates/",
            });
            expect(exchangeRates.statusCode).toEqual(404);
        });
        it("should response exchange rates by currency", async () => {
            const data = [
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "117.201880",
                    exchange_date: "2023-01-22",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "116.201880",
                    exchange_date: "2023-01-21",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "115.201880",
                    exchange_date: "2023-01-20",
                },
                {
                    source_currency: "EUR",
                    target_currency: "JPY",
                    source_rate: "1",
                    target_rate: "120",
                    exchange_date: "2023-01-20",
                },
            ];
            knex.table = () => ({
                select: () => {
                    return [{ rates: JSON.stringify(data), posting_date: "2024-01-20" }];
                },
            });
            const exchangeRates = await app.inject({
                method: "GET",
                url: "/public/exchange-rates/RSD",
            });
            expect(exchangeRates.statusCode).toBe(200);
            expect(JSON.parse(exchangeRates.body)).toEqual({
                data: {
                    RSD: [
                        { date: "2023-01-22", source_rate: "1", target_rate: "117.201880" },
                        { date: "2023-01-21", source_rate: "1", target_rate: "116.201880" },
                        { date: "2023-01-20", source_rate: "1", target_rate: "115.201880" },
                    ],
                },
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpbW5hY2lzY2lvbmlzL2dpdC9wZXJzb25hbC9zZWItZXhjaGFuZ2UtcmF0ZXMvYmFja2VuZC90ZXN0L3VuaXQvcm91dGVzL3B1YmxpYy9nZXQtZXhjaGFuZ2UtcmF0ZXMtYnktY3VycmVuY3kudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQWVBLElBQUksQ0FBQyxJQUFJLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO0lBQ2xELE9BQU8sVUFBVSxDQUFDO0FBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBaEJILDRDQUl5QjtBQUN6QixvRUFBZ0M7QUFFaEMsSUFBSSxHQUFvQixDQUFDO0FBQ3pCLElBQUksSUFBSSxHQUFHLElBQUEsbUNBQTBCLEdBQUUsQ0FBQztBQUV4QyxNQUFNLFVBQVUsR0FBRyxJQUFBLHdCQUFFLEVBQUMsS0FBSyxFQUFFLE9BQVksRUFBRSxPQUFZLEVBQUUsRUFBRTtJQUN2RCxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNuQyxDQUFDLENBQUMsQ0FBQztBQU1ILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNqQixHQUFHLEdBQUcsTUFBTSxJQUFBLHFCQUFZLEdBQUUsQ0FBQztBQUMvQixDQUFDLENBQUMsQ0FBQztBQUVILFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNsQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDaEIsTUFBTSxJQUFBLG9CQUFXLEdBQUUsQ0FBQztBQUN4QixDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyx3Q0FBd0MsRUFBRSxHQUFHLEVBQUU7SUFDcEQsUUFBUSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtRQUN6QyxFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEQsTUFBTSxJQUFJLEdBQUc7Z0JBQ1Q7b0JBQ0ksZUFBZSxFQUFFLEtBQUs7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O3dCQUNuRSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFO3dCQUNuRSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFO3FCQUN0RTtpQkFDSjthQUNKLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMva2ltbmFjaXNjaW9uaXMvZ2l0L3BlcnNvbmFsL3NlYi1leGNoYW5nZS1yYXRlcy9iYWNrZW5kL3Rlc3QvdW5pdC9yb3V0ZXMvcHVibGljL2dldC1leGNoYW5nZS1yYXRlcy1ieS1jdXJyZW5jeS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZhc3RpZnlJbnN0YW5jZSB9IGZyb20gXCJmYXN0aWZ5XCI7XG5pbXBvcnQge1xuICAgIGdldERlZmF1bHRLbmV4UGx1Z2luUGFyYW1zLFxuICAgIHN0YXJ0VGVzdEVudixcbiAgICBzdG9wVGVzdEVudixcbn0gZnJvbSBcIi4uLy4uLy4uL2hlbHBlclwiO1xuaW1wb3J0IGZwIGZyb20gXCJmYXN0aWZ5LXBsdWdpblwiO1xuXG5sZXQgYXBwOiBGYXN0aWZ5SW5zdGFuY2U7XG5sZXQga25leCA9IGdldERlZmF1bHRLbmV4UGx1Z2luUGFyYW1zKCk7XG5cbmNvbnN0IGtuZXhQbHVnaW4gPSBmcChhc3luYyAoZmFzdGlmeTogYW55LCBvcHRpb25zOiBhbnkpID0+IHtcbiAgICBmYXN0aWZ5LmRlY29yYXRlKFwia25leFwiLCBrbmV4KTtcbn0pO1xuXG5qZXN0Lm1vY2soXCIuLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9rbmV4LXBsdWdpblwiLCAoKSA9PiB7XG4gICAgcmV0dXJuIGtuZXhQbHVnaW47XG59KTtcblxuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICBhcHAgPSBhd2FpdCBzdGFydFRlc3RFbnYoKTtcbn0pO1xuXG5iZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBqZXN0LnJlc2V0QWxsTW9ja3MoKTtcbn0pO1xuXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgc3RvcFRlc3RFbnYoKTtcbn0pO1xuXG5kZXNjcmliZSgnZW5kcG9pbnRzIC9wdWJsaWMvZXhjaGFuZ2UtcmF0ZXMgY2FsbHMnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoXCJHRVQgL3B1YmxpYy9leGNoYW5nZS1yYXRlcy9cIiwgKCkgPT4ge1xuICAgICAgICBpdChcInNob3VsZCByZXNwb25zZSB3aXRoIGV4Y2hhbmdlIHJhdGVzIGRhdGFcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9jdXJyZW5jeTogXCJFVVJcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2N1cnJlbmN5OiBcIlJTRFwiLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfcmF0ZTogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9yYXRlOiBcIjExNy4yMDE4ODBcIixcbiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfZGF0ZTogXCIyMDIzLTAxLTIyXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9jdXJyZW5jeTogXCJFVVJcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2N1cnJlbmN5OiBcIlJTRFwiLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfcmF0ZTogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9yYXRlOiBcIjExNi4yMDE4ODBcIixcbiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfZGF0ZTogXCIyMDIzLTAxLTIxXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9jdXJyZW5jeTogXCJFVVJcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2N1cnJlbmN5OiBcIlJTRFwiLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfcmF0ZTogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9yYXRlOiBcIjExNS4yMDE4ODBcIixcbiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfZGF0ZTogXCIyMDIzLTAxLTIwXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9jdXJyZW5jeTogXCJFVVJcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2N1cnJlbmN5OiBcIkpQWVwiLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfcmF0ZTogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9yYXRlOiBcIjEyMFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjBcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAga25leC50YWJsZSA9ICgpID0+ICh7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbeyByYXRlczogSlNPTi5zdHJpbmdpZnkoZGF0YSksIHBvc3RpbmdfZGF0ZTogXCIyMDI0LTAxLTIwXCIgfV07XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBleGNoYW5nZVJhdGVzID0gYXdhaXQgYXBwLmluamVjdCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgIHVybDogXCIvcHVibGljL2V4Y2hhbmdlLXJhdGVzXCIsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KGV4Y2hhbmdlUmF0ZXMuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgICAgICAgZXhwZWN0KEpTT04ucGFyc2UoZXhjaGFuZ2VSYXRlcy5ib2R5KSkudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBSU0Q6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZGF0ZTogJzIwMjMtMDEtMjInLCBzb3VyY2VfcmF0ZTogJzEnLCB0YXJnZXRfcmF0ZTogJzExNy4yMDE4ODAnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGRhdGU6ICcyMDIzLTAxLTIxJywgc291cmNlX3JhdGU6ICcxJywgdGFyZ2V0X3JhdGU6ICcxMTYuMjAxODgwJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBkYXRlOiAnMjAyMy0wMS0yMCcsIHNvdXJjZV9yYXRlOiAnMScsIHRhcmdldF9yYXRlOiAnMTE1LjIwMTg4MCcgfVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICBKUFk6IFt7IGRhdGU6ICcyMDIzLTAxLTIwJywgc291cmNlX3JhdGU6ICcxJywgdGFyZ2V0X3JhdGU6ICcxMjAnIH1dXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiR0VUIC9wdWJsaWMvZXhjaGFuZ2UtcmF0ZXMvOmN1cnJlbmN5XCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJzaG91bGQgcmV0dXJuIDQwNCBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXhjaGFuZ2VSYXRlcyA9IGF3YWl0IGFwcC5pbmplY3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICB1cmw6IFwiL3B1YmxpYy9leGNoYW5nZS1yYXRlcy9cIixcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QoZXhjaGFuZ2VSYXRlcy5zdGF0dXNDb2RlKS50b0VxdWFsKDQwNCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcInNob3VsZCByZXNwb25zZSBleGNoYW5nZSByYXRlcyBieSBjdXJyZW5jeVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiUlNEXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTE3LjIwMTg4MFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjJcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiUlNEXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTE2LjIwMTg4MFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjFcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiUlNEXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTE1LjIwMTg4MFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjBcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiSlBZXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTIwXCIsXG4gICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX2RhdGU6IFwiMjAyMy0wMS0yMFwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBrbmV4LnRhYmxlID0gKCkgPT4gKHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt7IHJhdGVzOiBKU09OLnN0cmluZ2lmeShkYXRhKSwgcG9zdGluZ19kYXRlOiBcIjIwMjQtMDEtMjBcIiB9XTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGV4Y2hhbmdlUmF0ZXMgPSBhd2FpdCBhcHAuaW5qZWN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9wdWJsaWMvZXhjaGFuZ2UtcmF0ZXMvUlNEXCIsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KGV4Y2hhbmdlUmF0ZXMuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgICAgICAgZXhwZWN0KEpTT04ucGFyc2UoZXhjaGFuZ2VSYXRlcy5ib2R5KSkudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBSU0Q6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZGF0ZTogXCIyMDIzLTAxLTIyXCIsIHNvdXJjZV9yYXRlOiBcIjFcIiwgdGFyZ2V0X3JhdGU6IFwiMTE3LjIwMTg4MFwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGRhdGU6IFwiMjAyMy0wMS0yMVwiLCBzb3VyY2VfcmF0ZTogXCIxXCIsIHRhcmdldF9yYXRlOiBcIjExNi4yMDE4ODBcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBkYXRlOiBcIjIwMjMtMDEtMjBcIiwgc291cmNlX3JhdGU6IFwiMVwiLCB0YXJnZXRfcmF0ZTogXCIxMTUuMjAxODgwXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSlcbiJdLCJ2ZXJzaW9uIjozfQ==