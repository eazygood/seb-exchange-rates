d38009f21e9072a64809859ae4759ec2
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock("../../../../src/plugins/knex-plugin", () => {
    return knexPlugin;
});
const helper_1 = require("../../../helper");
const fastify_plugin_1 = __importDefault(require("fastify-plugin"));
let app;
let knex = (0, helper_1.getDefaultKnexPluginParams)();
const knexPlugin = (0, fastify_plugin_1.default)(async (fastify, options) => {
    fastify.decorate("knex", knex);
});
beforeAll(async () => {
    app = await (0, helper_1.startTestEnv)();
});
beforeEach(async () => {
    jest.resetAllMocks();
});
afterAll(async () => {
    await (0, helper_1.stopTestEnv)();
});
describe('endpoints /public/exchange-rates calls', () => {
    describe("GET /public/exchange-rates/", () => {
        it("should response with exchange rates data", async () => {
            const data = [
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "117.201880",
                    exchange_date: "2023-01-22",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "116.201880",
                    exchange_date: "2023-01-21",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "115.201880",
                    exchange_date: "2023-01-20",
                },
                {
                    source_currency: "EUR",
                    target_currency: "JPY",
                    source_rate: "1",
                    target_rate: "120",
                    exchange_date: "2023-01-20",
                },
            ];
            knex.table = () => ({
                select: () => {
                    return [{ rates: JSON.stringify(data), posting_date: "2024-01-20" }];
                },
            });
            const exchangeRates = await app.inject({
                method: "GET",
                url: "/public/exchange-rates",
            });
            expect(exchangeRates.statusCode).toBe(200);
            expect(JSON.parse(exchangeRates.body)).toEqual({
                data: {
                    RSD: [
                        { date: '2023-01-22', source_rate: '1', target_rate: '117.201880' },
                        { date: '2023-01-21', source_rate: '1', target_rate: '116.201880' },
                        { date: '2023-01-20', source_rate: '1', target_rate: '115.201880' }
                    ],
                    JPY: [{ date: '2023-01-20', source_rate: '1', target_rate: '120' }]
                },
            });
        });
    });
    describe("GET /public/exchange-rates/:currency", () => {
        it("should return 404 not found", async () => {
            const exchangeRates = await app.inject({
                method: "GET",
                url: "/public/exchange-rates/",
            });
            expect(exchangeRates.statusCode).toEqual(404);
        });
        it("should response exchange rates by currency", async () => {
            const data = [
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "117.201880",
                    exchange_date: "2023-01-22",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "116.201880",
                    exchange_date: "2023-01-21",
                },
                {
                    source_currency: "EUR",
                    target_currency: "RSD",
                    source_rate: "1",
                    target_rate: "115.201880",
                    exchange_date: "2023-01-20",
                },
                {
                    source_currency: "EUR",
                    target_currency: "JPY",
                    source_rate: "1",
                    target_rate: "120",
                    exchange_date: "2023-01-20",
                },
            ];
            knex.table = () => ({
                select: () => {
                    return [{ rates: JSON.stringify(data), posting_date: "2024-01-20" }];
                },
            });
            const exchangeRates = await app.inject({
                method: "GET",
                url: "/public/exchange-rates/RSD",
            });
            expect(exchangeRates.statusCode).toBe(200);
            expect(JSON.parse(exchangeRates.body)).toEqual({
                data: {
                    RSD: [
                        { date: "2023-01-22", source_rate: "1", target_rate: "117.201880" },
                        { date: "2023-01-21", source_rate: "1", target_rate: "116.201880" },
                        { date: "2023-01-20", source_rate: "1", target_rate: "115.201880" },
                    ],
                },
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpbW5hY2lzY2lvbmlzL2dpdC9wZXJzb25hbC9zZWItZXhjaGFuZ2UtcmF0ZXMvdGVzdC91bml0L3JvdXRlcy9wdWJsaWMvZ2V0LWV4Y2hhbmdlLXJhdGVzLWJ5LWN1cnJlbmN5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFlQSxJQUFJLENBQUMsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtJQUNsRCxPQUFPLFVBQVUsQ0FBQztBQUN0QixDQUFDLENBQUMsQ0FBQztBQWhCSCw0Q0FJeUI7QUFDekIsb0VBQWdDO0FBRWhDLElBQUksR0FBb0IsQ0FBQztBQUN6QixJQUFJLElBQUksR0FBRyxJQUFBLG1DQUEwQixHQUFFLENBQUM7QUFFeEMsTUFBTSxVQUFVLEdBQUcsSUFBQSx3QkFBRSxFQUFDLEtBQUssRUFBRSxPQUFZLEVBQUUsT0FBWSxFQUFFLEVBQUU7SUFDdkQsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDbkMsQ0FBQyxDQUFDLENBQUM7QUFNSCxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDakIsR0FBRyxHQUFHLE1BQU0sSUFBQSxxQkFBWSxHQUFFLENBQUM7QUFDL0IsQ0FBQyxDQUFDLENBQUM7QUFFSCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDbEIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO0lBQ2hCLE1BQU0sSUFBQSxvQkFBVyxHQUFFLENBQUM7QUFDeEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO0lBQ3BELFFBQVEsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7UUFDekMsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RELE1BQU0sSUFBSSxHQUFHO2dCQUNUO29CQUNJLGVBQWUsRUFBRSxLQUFLO29CQUN0Qixl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RUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRTt3QkFDbkUsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRTtxQkFDdEU7aUJBQ0o7YUFDSixDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpbW5hY2lzY2lvbmlzL2dpdC9wZXJzb25hbC9zZWItZXhjaGFuZ2UtcmF0ZXMvdGVzdC91bml0L3JvdXRlcy9wdWJsaWMvZ2V0LWV4Y2hhbmdlLXJhdGVzLWJ5LWN1cnJlbmN5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmFzdGlmeUluc3RhbmNlIH0gZnJvbSBcImZhc3RpZnlcIjtcbmltcG9ydCB7XG4gICAgZ2V0RGVmYXVsdEtuZXhQbHVnaW5QYXJhbXMsXG4gICAgc3RhcnRUZXN0RW52LFxuICAgIHN0b3BUZXN0RW52LFxufSBmcm9tIFwiLi4vLi4vLi4vaGVscGVyXCI7XG5pbXBvcnQgZnAgZnJvbSBcImZhc3RpZnktcGx1Z2luXCI7XG5cbmxldCBhcHA6IEZhc3RpZnlJbnN0YW5jZTtcbmxldCBrbmV4ID0gZ2V0RGVmYXVsdEtuZXhQbHVnaW5QYXJhbXMoKTtcblxuY29uc3Qga25leFBsdWdpbiA9IGZwKGFzeW5jIChmYXN0aWZ5OiBhbnksIG9wdGlvbnM6IGFueSkgPT4ge1xuICAgIGZhc3RpZnkuZGVjb3JhdGUoXCJrbmV4XCIsIGtuZXgpO1xufSk7XG5cbmplc3QubW9jayhcIi4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2tuZXgtcGx1Z2luXCIsICgpID0+IHtcbiAgICByZXR1cm4ga25leFBsdWdpbjtcbn0pO1xuXG5iZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGFwcCA9IGF3YWl0IHN0YXJ0VGVzdEVudigpO1xufSk7XG5cbmJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGplc3QucmVzZXRBbGxNb2NrcygpO1xufSk7XG5cbmFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBzdG9wVGVzdEVudigpO1xufSk7XG5cbmRlc2NyaWJlKCdlbmRwb2ludHMgL3B1YmxpYy9leGNoYW5nZS1yYXRlcyBjYWxscycsICgpID0+IHtcbiAgICBkZXNjcmliZShcIkdFVCAvcHVibGljL2V4Y2hhbmdlLXJhdGVzL1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJlc3BvbnNlIHdpdGggZXhjaGFuZ2UgcmF0ZXMgZGF0YVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiUlNEXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTE3LjIwMTg4MFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjJcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiUlNEXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTE2LjIwMTg4MFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjFcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiUlNEXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTE1LjIwMTg4MFwiLFxuICAgICAgICAgICAgICAgICAgICBleGNoYW5nZV9kYXRlOiBcIjIwMjMtMDEtMjBcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX2N1cnJlbmN5OiBcIkVVUlwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfY3VycmVuY3k6IFwiSlBZXCIsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZV9yYXRlOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3JhdGU6IFwiMTIwXCIsXG4gICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX2RhdGU6IFwiMjAyMy0wMS0yMFwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBrbmV4LnRhYmxlID0gKCkgPT4gKHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt7IHJhdGVzOiBKU09OLnN0cmluZ2lmeShkYXRhKSwgcG9zdGluZ19kYXRlOiBcIjIwMjQtMDEtMjBcIiB9XTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGV4Y2hhbmdlUmF0ZXMgPSBhd2FpdCBhcHAuaW5qZWN0KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9wdWJsaWMvZXhjaGFuZ2UtcmF0ZXNcIixcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QoZXhjaGFuZ2VSYXRlcy5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XG4gICAgICAgICAgICBleHBlY3QoSlNPTi5wYXJzZShleGNoYW5nZVJhdGVzLmJvZHkpKS50b0VxdWFsKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFJTRDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgeyBkYXRlOiAnMjAyMy0wMS0yMicsIHNvdXJjZV9yYXRlOiAnMScsIHRhcmdldF9yYXRlOiAnMTE3LjIwMTg4MCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZGF0ZTogJzIwMjMtMDEtMjEnLCBzb3VyY2VfcmF0ZTogJzEnLCB0YXJnZXRfcmF0ZTogJzExNi4yMDE4ODAnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGRhdGU6ICcyMDIzLTAxLTIwJywgc291cmNlX3JhdGU6ICcxJywgdGFyZ2V0X3JhdGU6ICcxMTUuMjAxODgwJyB9XG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIEpQWTogW3sgZGF0ZTogJzIwMjMtMDEtMjAnLCBzb3VyY2VfcmF0ZTogJzEnLCB0YXJnZXRfcmF0ZTogJzEyMCcgfV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJHRVQgL3B1YmxpYy9leGNoYW5nZS1yYXRlcy86Y3VycmVuY3lcIiwgKCkgPT4ge1xuICAgICAgICBpdChcInNob3VsZCByZXR1cm4gNDA0IG5vdCBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleGNoYW5nZVJhdGVzID0gYXdhaXQgYXBwLmluamVjdCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgIHVybDogXCIvcHVibGljL2V4Y2hhbmdlLXJhdGVzL1wiLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChleGNoYW5nZVJhdGVzLnN0YXR1c0NvZGUpLnRvRXF1YWwoNDA0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwic2hvdWxkIHJlc3BvbnNlIGV4Y2hhbmdlIHJhdGVzIGJ5IGN1cnJlbmN5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfY3VycmVuY3k6IFwiRVVSXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9jdXJyZW5jeTogXCJSU0RcIixcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX3JhdGU6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcmF0ZTogXCIxMTcuMjAxODgwXCIsXG4gICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX2RhdGU6IFwiMjAyMy0wMS0yMlwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfY3VycmVuY3k6IFwiRVVSXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9jdXJyZW5jeTogXCJSU0RcIixcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX3JhdGU6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcmF0ZTogXCIxMTYuMjAxODgwXCIsXG4gICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX2RhdGU6IFwiMjAyMy0wMS0yMVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfY3VycmVuY3k6IFwiRVVSXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9jdXJyZW5jeTogXCJSU0RcIixcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX3JhdGU6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcmF0ZTogXCIxMTUuMjAxODgwXCIsXG4gICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlX2RhdGU6IFwiMjAyMy0wMS0yMFwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VfY3VycmVuY3k6IFwiRVVSXCIsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF9jdXJyZW5jeTogXCJKUFlcIixcbiAgICAgICAgICAgICAgICAgICAgc291cmNlX3JhdGU6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcmF0ZTogXCIxMjBcIixcbiAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2VfZGF0ZTogXCIyMDIzLTAxLTIwXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGtuZXgudGFibGUgPSAoKSA9PiAoe1xuICAgICAgICAgICAgICAgIHNlbGVjdDogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3sgcmF0ZXM6IEpTT04uc3RyaW5naWZ5KGRhdGEpLCBwb3N0aW5nX2RhdGU6IFwiMjAyNC0wMS0yMFwiIH1dO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgZXhjaGFuZ2VSYXRlcyA9IGF3YWl0IGFwcC5pbmplY3Qoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICB1cmw6IFwiL3B1YmxpYy9leGNoYW5nZS1yYXRlcy9SU0RcIixcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QoZXhjaGFuZ2VSYXRlcy5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XG4gICAgICAgICAgICBleHBlY3QoSlNPTi5wYXJzZShleGNoYW5nZVJhdGVzLmJvZHkpKS50b0VxdWFsKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFJTRDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgeyBkYXRlOiBcIjIwMjMtMDEtMjJcIiwgc291cmNlX3JhdGU6IFwiMVwiLCB0YXJnZXRfcmF0ZTogXCIxMTcuMjAxODgwXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZGF0ZTogXCIyMDIzLTAxLTIxXCIsIHNvdXJjZV9yYXRlOiBcIjFcIiwgdGFyZ2V0X3JhdGU6IFwiMTE2LjIwMTg4MFwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGRhdGU6IFwiMjAyMy0wMS0yMFwiLCBzb3VyY2VfcmF0ZTogXCIxXCIsIHRhcmdldF9yYXRlOiBcIjExNS4yMDE4ODBcIiB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KVxuIl0sInZlcnNpb24iOjN9