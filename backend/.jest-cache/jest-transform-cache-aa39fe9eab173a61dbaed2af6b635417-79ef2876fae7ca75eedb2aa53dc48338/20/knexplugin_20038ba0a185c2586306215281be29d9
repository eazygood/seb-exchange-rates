222e5f020ecd9da38972061e82337b98
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fastify_plugin_1 = __importDefault(require("fastify-plugin"));
const Knex = require("knex");
const knexPlugin = async (fastify, options) => {
    // TODO: can be configured with pool connection
    // const connection  = mysql.createConnection(options);
    const knex = Knex(options);
    fastify.decorate("knex", knex);
    fastify.addHook("onClose", async () => {
        await fastify.knex.destroy();
    });
};
exports.default = (0, fastify_plugin_1.default)(knexPlugin, {
    name: "knex",
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2tpbW5hY2lzY2lvbmlzL2dpdC9wZXJzb25hbC9zZWItZXhjaGFuZ2UtcmF0ZXMvc3JjL3BsdWdpbnMva25leC1wbHVnaW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxvRUFBZ0M7QUFDaEMsNkJBQThCO0FBTzlCLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFBRSxPQUF3QixFQUFFLE9BQVksRUFBRSxFQUFFO0lBQ25FLCtDQUErQztJQUMvQyx1REFBdUQ7SUFDdkQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNCLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRS9CLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ3JDLE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM5QixDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGtCQUFlLElBQUEsd0JBQUUsRUFBQyxVQUFVLEVBQUU7SUFDN0IsSUFBSSxFQUFFLE1BQU07Q0FDWixDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2tpbW5hY2lzY2lvbmlzL2dpdC9wZXJzb25hbC9zZWItZXhjaGFuZ2UtcmF0ZXMvc3JjL3BsdWdpbnMva25leC1wbHVnaW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmFzdGlmeUluc3RhbmNlIH0gZnJvbSBcImZhc3RpZnlcIjtcbmltcG9ydCBmcCBmcm9tIFwiZmFzdGlmeS1wbHVnaW5cIjtcbmltcG9ydCBLbmV4ID0gcmVxdWlyZShcImtuZXhcIik7XG5cbmRlY2xhcmUgbW9kdWxlIFwiZmFzdGlmeVwiIHtcblx0aW50ZXJmYWNlIEZhc3RpZnlJbnN0YW5jZSB7XG5cdFx0a25leDogS25leC5LbmV4O1xuXHR9XG59XG5jb25zdCBrbmV4UGx1Z2luID0gYXN5bmMgKGZhc3RpZnk6IEZhc3RpZnlJbnN0YW5jZSwgb3B0aW9uczogYW55KSA9PiB7XG5cdC8vIFRPRE86IGNhbiBiZSBjb25maWd1cmVkIHdpdGggcG9vbCBjb25uZWN0aW9uXG5cdC8vIGNvbnN0IGNvbm5lY3Rpb24gID0gbXlzcWwuY3JlYXRlQ29ubmVjdGlvbihvcHRpb25zKTtcblx0Y29uc3Qga25leCA9IEtuZXgob3B0aW9ucyk7XG5cdGZhc3RpZnkuZGVjb3JhdGUoXCJrbmV4XCIsIGtuZXgpO1xuXG5cdGZhc3RpZnkuYWRkSG9vayhcIm9uQ2xvc2VcIiwgYXN5bmMgKCkgPT4ge1xuXHRcdGF3YWl0IGZhc3RpZnkua25leC5kZXN0cm95KCk7XG5cdH0pO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZnAoa25leFBsdWdpbiwge1xuXHRuYW1lOiBcImtuZXhcIixcbn0pO1xuIl0sInZlcnNpb24iOjN9